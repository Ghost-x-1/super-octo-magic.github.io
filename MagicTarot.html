<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ˜Ÿè¾°å¡”ç½—æ—¥è¿</title>
    <style>
        :root {
            --purple-dark: #1a103d;
            --purple-mid: #3d2e8f;
            --purple-light: #6a4cbf;
            --gold: #f8d56b;
            --pink: #e6a8d7;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: radial-gradient(circle at 10% 20%, var(--purple-dark) 0%, #000 60%);
            color: #e6e6e6;
            min-height: 100vh;
            padding: 15px;
            margin: 0;
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 10px;
        }
        
        h1 {
            color: var(--gold);
            text-align: center;
            margin: 15px 0;
            font-size: 1.8rem;
        }
        
        .settings {
            background: rgba(61, 46, 143, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            text-align: center;
            font-size: 0.95rem;
        }
        
        .btn {
            background: var(--purple-light);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1rem;
            border-radius: 50px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
            transition: all 0.3s;
            width: 80%;
            max-width: 250px;
            font-weight: bold;
        }
        
        .btn:hover {
            background: var(--purple-mid);
            transform: translateY(-3px);
        }
        
        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        
        .card-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
            perspective: 1000px;
        }
        
        .card {
            width: 28vw;
            height: 48vw;
            max-width: 120px;
            max-height: 200px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
            border-radius: 8px;
            margin: 5px;
        }
        
        .card.flipped {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            padding: 8px;
            text-align: center;
        }
        
        .card-front {
            background: linear-gradient(135deg, #f8d56b 0%, #e6a8d7 100%);
            color: var(--purple-dark);
            transform: rotateY(180deg);
        }
        
        .card-back {
            background: linear-gradient(135deg, var(--purple-mid) 0%, var(--purple-dark) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-back::before {
            content: "";
            position: absolute;
            width: 80%;
            height: 80%;
            border: 2px solid var(--gold);
            border-radius: 6px;
            opacity: 0.5;
        }
        
        .card-back::after {
            content: "âœ¦";
            font-size: 30px;
            color: var(--gold);
            opacity: 0.7;
        }
        
        .card-name {
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 4px;
            word-break: break-word;
        }
        
        .card-suit {
            font-size: 0.7rem;
            font-style: italic;
            margin-bottom: 4px;
        }
        
        .card-orientation {
            font-size: 0.75rem;
            color: var(--purple-mid);
            font-weight: bold;
        }
        
        .reading-area {
            background: rgba(26, 16, 61, 0.7);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            transition: all 0.5s ease-in-out;
            font-size: 0.95rem;
        }
        
        .category {
            margin-bottom: 18px;
        }
        
        .category-title {
            color: var(--gold);
            font-size: 1.1rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .category-title .icon {
            margin-right: 8px;
            font-size: 1em;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: #ff6b6b;
            text-align: center;
            margin: 15px 0;
            font-size: 0.95rem;
        }
        
        @keyframes dealCard {
            0% {
                transform: translateY(-50px) rotateY(-90deg);
                opacity: 0;
            }
            100% {
                transform: translateY(0) rotateY(0);
                opacity: 1;
            }
        }
        
        .card.dealing {
            animation: dealCard 0.8s ease-out forwards;
        }
        
        /* ç»¼åˆè§£è¯»æ ·å¼ */
        .overall-reading {
            background: rgba(106, 76, 191, 0.2);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 20px;
            border-left: 4px solid var(--gold);
        }
        
        .overall-title {
            color: var(--gold);
            font-size: 1.2rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .energy-bar-container {
            margin: 12px 0;
        }
        
        .energy-bar {
            height: 18px;
            background: rgba(255,255,255,0.1);
            border-radius: 9px;
            overflow: hidden;
            position: relative;
        }
        
        .energy-level {
            height: 100%;
            background: linear-gradient(90deg, #f44336, #FFC107, #4CAF50);
            transition: width 1s ease;
            border-radius: 9px;
        }
        
        .energy-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.75rem;
            color: rgba(255,255,255,0.7);
        }
        
        .element-tags {
            display: flex;
            gap: 6px;
            margin: 8px 0;
            flex-wrap: wrap;
        }
        
        .element-tag {
            background: rgba(248, 213, 107, 0.2);
            border: 1px solid var(--gold);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
        }
        
        .advice-box {
            background: rgba(230, 168, 215, 0.1);
            border-radius: 8px;
            padding: 10px;
            margin-top: 12px;
            border-left: 3px solid var(--pink);
        }
        
        .advice-title {
            color: var(--pink);
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .card {
                width: 30vw;
                height: 50vw;
            }
            
            .card-name {
                font-size: 0.8rem;
            }
            
            .reading-area {
                padding: 12px;
            }
            
            .btn {
                width: 90%;
                padding: 12px;
            }
        }
        
        @media (max-width: 360px) {
            .card {
                width: 28vw;
                height: 48vw;
            }
            
            .card-name {
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ¨ å¡”ç½—æ—¥è¿å åœ âœ¨</h1>
        
        <div class="settings">
            <label>
                <input type="radio" name="deckType" value="full" checked> ä½¿ç”¨å®Œæ•´78å¼ ç‰Œç»„
            </label>
        </div>
        
        <button id="drawBtn" class="btn">æŠ½å–ä»Šæ—¥è¿åŠ¿</button>
        
        <div id="cardDisplay" class="card-container hidden"></div>
        
        <div id="errorMsg" class="error hidden"></div>
        
        <div id="readingDisplay" class="reading-area hidden">
            <div class="overall-reading">
                <div class="overall-title">
                    <span class="icon">ğŸ”®</span>ä»Šæ—¥ç»¼åˆè¿åŠ¿
                </div>
                <div id="overallReading"></div>
                <div class="energy-bar-container">
                    <div class="energy-bar">
                        <div class="energy-level" id="energyLevel"></div>
                    </div>
                    <div class="energy-labels">
                        <span>ä½èƒ½é‡</span>
                        <span>ä¸­èƒ½é‡</span>
                        <span>é«˜èƒ½é‡</span>
                    </div>
                </div>
                <div class="element-tags" id="elementTags"></div>
                <div class="advice-box">
                    <div class="advice-title">âœ¨ ä»Šæ—¥ç®´è¨€</div>
                    <div id="dailyAdvice"></div>
                </div>
            </div>
            
            <div class="category">
                <div class="category-title">
                    <span class="icon">ğŸ¢</span>å·¥ä½œè¿åŠ¿
                </div>
                <div id="workReading"></div>
            </div>
            
            <div class="category">
                <div class="category-title">
                    <span class="icon">â¤ï¸</span>æƒ…æ„ŸçŠ¶æ€
                </div>
                <div id="loveReading"></div>
            </div>
            
            <div class="category">
                <div class="category-title">
                    <span class="icon">ğŸ“š</span>å­¦ä¹ èƒ½é‡
                </div>
                <div id="studyReading"></div>
            </div>
        </div>
    </div>

    <script>
        // å¡”ç½—ç‰Œæ•°æ®åº“
        const tarotDB = {
            major: [
                { name: "0. æ„šè€…", keywords: ["å†’é™©", "å¤©çœŸ", "æ–°çš„å¼€å§‹"], element: "é£" },
                { name: "I. é­”æœ¯å¸ˆ", keywords: ["åˆ›é€ ", "æŠ€èƒ½", "ä¸“æ³¨"], element: "æ°´æ˜Ÿ" },
                { name: "II. å¥³ç¥­å¸", keywords: ["ç›´è§‰", "ç¥ç§˜", "æ™ºæ…§"], element: "æœˆäº®" },
                { name: "III. çš‡å", keywords: ["ä¸°ç››", "æ»‹å…»", "æ„Ÿæ€§"], element: "é‡‘æ˜Ÿ" },
                { name: "IV. çš‡å¸", keywords: ["æƒå¨", "ç»“æ„", "æ§åˆ¶"], element: "ç™½ç¾Šåº§" },
                { name: "V. æ•™çš‡", keywords: ["ä¼ ç»Ÿ", "ä¿¡ä»°", "æ•™è‚²"], element: "é‡‘ç‰›åº§" },
                { name: "VI. æ‹äºº", keywords: ["å…³ç³»", "é€‰æ‹©", "å’Œè°"], element: "åŒå­åº§" },
                { name: "VII. æˆ˜è½¦", keywords: ["èƒœåˆ©", "æ„å¿—åŠ›", "å‰è¿›"], element: "å·¨èŸ¹åº§" },
                { name: "VIII. åŠ›é‡", keywords: ["å‹‡æ°”", "è€å¿ƒ", "å†…åœ¨åŠ›é‡"], element: "ç‹®å­åº§" },
                { name: "IX. éšå£«", keywords: ["å†…çœ", "å­¤ç‹¬", "æŒ‡å¼•"], element: "å¤„å¥³åº§" },
                { name: "X. å‘½è¿ä¹‹è½®", keywords: ["å‘½è¿", "å˜åŒ–", "å‘¨æœŸ"], element: "æœ¨æ˜Ÿ" },
                { name: "XI. æ­£ä¹‰", keywords: ["å…¬å¹³", "çœŸç›¸", "å› æœ"], element: "å¤©ç§¤åº§" },
                { name: "XII. å€’åŠäºº", keywords: ["ç‰ºç‰²", "æ–°è§†è§’", "ç­‰å¾…"], element: "æ°´" },
                { name: "XIII. æ­»ç¥", keywords: ["ç»“æŸ", "è½¬å˜", "æ–°ç”Ÿ"], element: "å¤©èåº§" },
                { name: "XIV. èŠ‚åˆ¶", keywords: ["å¹³è¡¡", "è°ƒå’Œ", "é€‚åº¦"], element: "å°„æ‰‹åº§" },
                { name: "XV. æ¶é­”", keywords: ["æŸç¼š", "ç‰©è´¨", "æ¬²æœ›"], element: "æ‘©ç¾¯åº§" },
                { name: "XVI. é«˜å¡”", keywords: ["çªå˜", "å¯ç¤º", "è§£æ”¾"], element: "ç«æ˜Ÿ" },
                { name: "XVII. æ˜Ÿæ˜Ÿ", keywords: ["å¸Œæœ›", "çµæ„Ÿ", "æ²»æ„ˆ"], element: "æ°´ç“¶åº§" },
                { name: "XVIII. æœˆäº®", keywords: ["å¹»è§‰", "æ½œæ„è¯†", "ä¸å®‰"], element: "åŒé±¼åº§" },
                { name: "XIX. å¤ªé˜³", keywords: ["å¿«ä¹", "æˆåŠŸ", "æ´»åŠ›"], element: "å¤ªé˜³" },
                { name: "XX. å®¡åˆ¤", keywords: ["è§‰é†’", "é‡ç”Ÿ", "èµ¦å…"], element: "ç«" },
                { name: "XXI. ä¸–ç•Œ", keywords: ["å®Œæˆ", "æˆå°±", "æ—…è¡Œ"], element: "åœŸæ˜Ÿ" }
            ],
            minor: {
                wands: [
                    { name: "æƒæ–ä¸€", keywords: ["èƒ½é‡", "çµæ„Ÿ", "è¡ŒåŠ¨"], number: 1, element: "ç«" },
                    { name: "æƒæ–äºŒ", keywords: ["è®¡åˆ’", "æœªæ¥", "å†³å®š"], number: 2, element: "ç«" },
                    { name: "æƒæ–ä¸‰", keywords: ["è¿œè§", "æ‰©å¼ ", "é¢†å¯¼"], number: 3, element: "ç«" },
                    { name: "æƒæ–å››", keywords: ["åº†ç¥", "å’Œè°", "å®¶"], number: 4, element: "ç«" },
                    { name: "æƒæ–äº”", keywords: ["å†²çª", "ç«äº‰", "äº‰è®º"], number: 5, element: "ç«" },
                    { name: "æƒæ–å…­", keywords: ["èƒœåˆ©", "è¿›æ­¥", "è®¤å¯"], number: 6, element: "ç«" },
                    { name: "æƒæ–ä¸ƒ", keywords: ["æŒ‘æˆ˜", "åšæŒ", "é˜²å¾¡"], number: 7, element: "ç«" },
                    { name: "æƒæ–å…«", keywords: ["é€Ÿåº¦", "è¡ŒåŠ¨", "æ¶ˆæ¯"], number: 8, element: "ç«" },
                    { name: "æƒæ–ä¹", keywords: ["æ¯…åŠ›", "è­¦æƒ•", "åŠ›é‡"], number: 9, element: "ç«" },
                    { name: "æƒæ–å", keywords: ["è´Ÿæ‹…", "è´£ä»»", "å‹åŠ›"], number: 10, element: "ç«" },
                    { name: "æƒæ–ä¾ä»", keywords: ["æ¢ç´¢", "çƒ­æƒ…", "æ¶ˆæ¯"], court: "ä¾ä»", element: "ç«" },
                    { name: "æƒæ–éª‘å£«", keywords: ["èƒ½é‡", "å†’é™©", "å†²åŠ¨"], court: "éª‘å£«", element: "ç«" },
                    { name: "æƒæ–çš‡å", keywords: ["æ´»åŠ›", "è‡ªä¿¡", "æ¸©æš–"], court: "çš‡å", element: "ç«" },
                    { name: "æƒæ–å›½ç‹", keywords: ["é¢†å¯¼", "è¿œè§", "ä¼ä¸šå®¶"], court: "å›½ç‹", element: "ç«" }
                ],
                cups: [
                    { name: "åœ£æ¯ä¸€", keywords: ["æƒ…æ„Ÿ", "ç›´è§‰", "æ–°å…³ç³»"], number: 1, element: "æ°´" },
                    { name: "åœ£æ¯äºŒ", keywords: ["å’Œè°", "åˆä½œ", "æ„Ÿæƒ…"], number: 2, element: "æ°´" },
                    { name: "åœ£æ¯ä¸‰", keywords: ["åº†ç¥", "å‹è°Š", "åˆ›é€ åŠ›"], number: 3, element: "æ°´" },
                    { name: "åœ£æ¯å››", keywords: ["æ²‰æ€", "ä¸æ»¡", "æ— èŠ"], number: 4, element: "æ°´" },
                    { name: "åœ£æ¯äº”", keywords: ["å¤±è½", "é—æ†¾", "æ‚²ä¼¤"], number: 5, element: "æ°´" },
                    { name: "åœ£æ¯å…­", keywords: ["æ€€æ—§", "ç«¥å¹´", "ç¤¼ç‰©"], number: 6, element: "æ°´" },
                    { name: "åœ£æ¯ä¸ƒ", keywords: ["é€‰æ‹©", "å¹»æƒ³", "ç™½æ—¥æ¢¦"], number: 7, element: "æ°´" },
                    { name: "åœ£æ¯å…«", keywords: ["ç¦»å¼€", "å¯»æ‰¾", "æ”¾å¼ƒ"], number: 8, element: "æ°´" },
                    { name: "åœ£æ¯ä¹", keywords: ["æ»¡è¶³", "æ„¿æœ›", "å¿«ä¹"], number: 9, element: "æ°´" },
                    { name: "åœ£æ¯å", keywords: ["å¹¸ç¦", "å®¶åº­", "å’Œè°"], number: 10, element: "æ°´" },
                    { name: "åœ£æ¯ä¾ä»", keywords: ["æ•æ„Ÿ", "åˆ›æ„", "ç›´è§‰"], court: "ä¾ä»", element: "æ°´" },
                    { name: "åœ£æ¯éª‘å£«", keywords: ["æµªæ¼«", "é­…åŠ›", "ç†æƒ³ä¸»ä¹‰"], court: "éª‘å£«", element: "æ°´" },
                    { name: "åœ£æ¯çš‡å", keywords: ["åŒæƒ…", "å…³æ€€", "æ²»æ„ˆ"], court: "çš‡å", element: "æ°´" },
                    { name: "åœ£æ¯å›½ç‹", keywords: ["æ™ºæ…§", "æƒ…æ„Ÿæ§åˆ¶", "å¯¼å¸ˆ"], court: "å›½ç‹", element: "æ°´" }
                ],
                swords: [
                    { name: "å®å‰‘ä¸€", keywords: ["çªç ´", "æ¸…æ™°", "çœŸç†"], number: 1, element: "é£" },
                    { name: "å®å‰‘äºŒ", keywords: ["é€‰æ‹©", "å¹³è¡¡", "åƒµå±€"], number: 2, element: "é£" },
                    { name: "å®å‰‘ä¸‰", keywords: ["å¿ƒç¢", "æ‚²ä¼¤", "ç—›è‹¦"], number: 3, element: "é£" },
                    { name: "å®å‰‘å››", keywords: ["ä¼‘æ¯", "æ¢å¤", "æ²‰æ€"], number: 4, element: "é£" },
                    { name: "å®å‰‘äº”", keywords: ["å†²çª", "èƒœåˆ©", "äº‰è®º"], number: 5, element: "é£" },
                    { name: "å®å‰‘å…­", keywords: ["è¿‡æ¸¡", "ç¦»å¼€", "æ²»æ„ˆ"], number: 6, element: "é£" },
                    { name: "å®å‰‘ä¸ƒ", keywords: ["æ¬ºéª—", "ç­–ç•¥", "ç§˜å¯†"], number: 7, element: "é£" },
                    { name: "å®å‰‘å…«", keywords: ["é™åˆ¶", "æ— åŠ©", "è‡ªæˆ‘æŸç¼š"], number: 8, element: "é£" },
                    { name: "å®å‰‘ä¹", keywords: ["ç„¦è™‘", "å™©æ¢¦", "ææƒ§"], number: 9, element: "é£" },
                    { name: "å®å‰‘å", keywords: ["ç»“æŸ", "ç—›è‹¦", "é‡ç”Ÿ"], number: 10, element: "é£" },
                    { name: "å®å‰‘ä¾ä»", keywords: ["è­¦è§‰", "å¥½å¥‡", "æ–°æƒ³æ³•"], court: "ä¾ä»", element: "é£" },
                    { name: "å®å‰‘éª‘å£«", keywords: ["è¡ŒåŠ¨", "å†²åŠ¨", "å†³å¿ƒ"], court: "éª‘å£«", element: "é£" },
                    { name: "å®å‰‘çš‡å", keywords: ["ç‹¬ç«‹", "æ¸…æ™°", "å…¬æ­£"], court: "çš‡å", element: "é£" },
                    { name: "å®å‰‘å›½ç‹", keywords: ["æƒå¨", "é€»è¾‘", "å†³æ–­"], court: "å›½ç‹", element: "é£" }
                ],
                pentacles: [
                    { name: "æ˜Ÿå¸ä¸€", keywords: ["ç¹è£", "æ–°æœºä¼š", "å®‰å…¨"], number: 1, element: "åœŸ" },
                    { name: "æ˜Ÿå¸äºŒ", keywords: ["å¹³è¡¡", "é€‚åº”", "èµ„æº"], number: 2, element: "åœŸ" },
                    { name: "æ˜Ÿå¸ä¸‰", keywords: ["å›¢é˜Ÿåˆä½œ", "å­¦ä¹ ", "æŠ€èƒ½"], number: 3, element: "åœŸ" },
                    { name: "æ˜Ÿå¸å››", keywords: ["ä¿å­˜", "å®‰å…¨", "æ§åˆ¶"], number: 4, element: "åœŸ" },
                    { name: "æ˜Ÿå¸äº”", keywords: ["å›°éš¾", "è´«å›°", "å­¤ç«‹"], number: 5, element: "åœŸ" },
                    { name: "æ˜Ÿå¸å…­", keywords: ["æ…·æ…¨", "æ…ˆå–„", "åˆ†äº«"], number: 6, element: "åœŸ" },
                    { name: "æ˜Ÿå¸ä¸ƒ", keywords: ["è¯„ä¼°", "è€å¿ƒ", "æŠ•èµ„"], number: 7, element: "åœŸ" },
                    { name: "æ˜Ÿå¸å…«", keywords: ["å·¥è‰º", "ä¸“æ³¨", "è´¨é‡"], number: 8, element: "åœŸ" },
                    { name: "æ˜Ÿå¸ä¹", keywords: ["ä¸°å¯Œ", "ç‹¬ç«‹", "äº«å—"], number: 9, element: "åœŸ" },
                    { name: "æ˜Ÿå¸å", keywords: ["è´¢å¯Œ", "å®¶åº­", "ä¼ ç»Ÿ"], number: 10, element: "åœŸ" },
                    { name: "æ˜Ÿå¸ä¾ä»", keywords: ["å­¦ä¹ ", "å‹¤å¥‹", "æ½œåŠ›"], court: "ä¾ä»", element: "åœŸ" },
                    { name: "æ˜Ÿå¸éª‘å£«", keywords: ["è´£ä»»", "å¯é ", "è¿›æ­¥"], court: "éª‘å£«", element: "åœŸ" },
                    { name: "æ˜Ÿå¸çš‡å", keywords: ["ç¹è£", "å®‰å…¨", "å…»è‚²"], court: "çš‡å", element: "åœŸ" },
                    { name: "æ˜Ÿå¸å›½ç‹", keywords: ["æˆåŠŸ", "ç®¡ç†", "ç¨³å®š"], court: "å›½ç‹", element: "åœŸ" }
                ]
            }
        };

        // ç”Ÿæˆç‰Œç»„
        function generateDeck(deckType) {
            let deck = [];
            
            // æ·»åŠ å¤§é˜¿å¡çº³
            tarotDB.major.forEach(card => {
                deck.push({
                    ...card,
                    type: "major",
                    suit: null,
                    work: generateGenericReading(card, "work"),
                    love: generateGenericReading(card, "love"),
                    study: generateGenericReading(card, "study")
                });
            });
            
            // æ·»åŠ å°é˜¿å¡çº³
            if (deckType === "full") {
                for (const [suit, cards] of Object.entries(tarotDB.minor)) {
                    cards.forEach(card => {
                        deck.push({
                            ...card,
                            type: "minor",
                            suit: suit,
                            work: generateGenericReading(card, "work"),
                            love: generateGenericReading(card, "love"),
                            study: generateGenericReading(card, "study")
                        });
                    });
                }
            }
            
            return deck;
        }

        // ç”Ÿæˆé€šç”¨è§£è¯»
        function generateGenericReading(card, category) {
            const orientation = {
                upright: [],
                reversed: []
            };
            
            // å·¥ä½œè§£è¯»
            if (category === "work") {
                orientation.upright = [
                    "å·¥ä½œè¿›å±•é¡ºåˆ©",
                    "å¯èƒ½æœ‰æ–°çš„æœºä¼š",
                    "å›¢é˜Ÿåˆä½œè‰¯å¥½"
                ];
                orientation.reversed = [
                    "å·¥ä½œä¸­é‡åˆ°é˜»ç¢",
                    "éœ€è¦é‡æ–°è¯„ä¼°è®¡åˆ’",
                    "æ³¨æ„æ²Ÿé€šé—®é¢˜"
                ];
            }
            // æƒ…æ„Ÿè§£è¯»
            else if (category === "love") {
                orientation.upright = [
                    "æ„Ÿæƒ…å’Œè°",
                    "å¯èƒ½æœ‰æ–°çš„é‚‚é€…",
                    "æ²Ÿé€šé¡ºç•…"
                ];
                orientation.reversed = [
                    "æƒ…æ„Ÿä¸Šéœ€è¦æ›´å¤šå…³æ³¨",
                    "å¯èƒ½å­˜åœ¨è¯¯è§£",
                    "éœ€è¦æ›´å¤šè€å¿ƒ"
                ];
            }
            // å­¦ä¹ è§£è¯»
            else if (category === "study") {
                orientation.upright = [
                    "å­¦ä¹ æ•ˆç‡é«˜",
                    "é€‚åˆå¸æ”¶æ–°çŸ¥è¯†",
                    "è€ƒè¯•è¿ä½³"
                ];
                orientation.reversed = [
                    "å­¦ä¹ é‡åˆ°ç“¶é¢ˆ",
                    "éœ€è¦è°ƒæ•´æ–¹æ³•",
                    "æ³¨æ„åŠ›ä¸é›†ä¸­"
                ];
            }
            
            // æ·»åŠ å»ºè®®
            orientation.advice = {
                upright: "æŠŠæ¡å½“ä¸‹æœºä¼šï¼Œç§¯æè¡ŒåŠ¨",
                reversed: "è°¨æ…è¡Œäº‹ï¼Œä¸‰æ€è€Œåè¡Œ"
            };
            
            return orientation;
        }

        // æ´—ç‰Œç®—æ³•
        function shuffleDeck(deck) {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        // æŠ½å–ç‰Œç»„
        function drawCards() {
            try {
                const deckType = document.querySelector('input[name="deckType"]:checked').value;
                let deck = generateDeck(deckType);
                
                if (deck.length === 0) {
                    throw new Error("ç‰Œç»„ä¸ºç©ºï¼Œè¯·æ£€æŸ¥ç‰Œç»„æ•°æ®");
                }
                
                deck = shuffleDeck(deck);
                
                return deck.slice(0, 3).map(card => ({
                    ...card,
                    orientation: Math.random() > 0.5 ? "æ­£ä½" : "é€†ä½"
                }));
            } catch (error) {
                console.error("æŠ½ç‰Œå‡ºé”™:", error);
                showError("æŠ½ç‰Œå¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");
                return [];
            }
        }

        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        function showError(message) {
            const errorEl = document.getElementById("errorMsg");
            errorEl.textContent = message;
            errorEl.classList.remove("hidden");
        }

        // éšè—é”™è¯¯ä¿¡æ¯
        function hideError() {
            document.getElementById("errorMsg").classList.add("hidden");
        }

        // ç”Ÿæˆç»¼åˆè§£è¯»
        function generateOverallReading(cards) {
            const reading = {
                elements: {},
                overallEnergy: 50, // é»˜è®¤50%
                themes: []
            };
            
            // åˆ†æå…ƒç´ å’Œæ­£é€†ä½
            let uprightCount = 0;
            cards.forEach(card => {
                // ç»Ÿè®¡å…ƒç´ 
                if (card.element) {
                    reading.elements[card.element] = (reading.elements[card.element] || 0) + 1;
                }
                
                // ç»Ÿè®¡æ­£é€†ä½
                if (card.orientation === "æ­£ä½") {
                    uprightCount++;
                }
                
                // æ”¶é›†å…³é”®è¯
                reading.themes.push(...card.keywords);
            });
            
            // è®¡ç®—èƒ½é‡å€¼ (0-100)
            if (uprightCount === 3) {
                reading.overallEnergy = 90;
            } else if (uprightCount === 2) {
                reading.overallEnergy = 70;
            } else if (uprightCount === 1) {
                reading.overallEnergy = 40;
            } else {
                reading.overallEnergy = 20;
            }
            
            // ç”Ÿæˆè§£è¯»æ–‡æœ¬
            reading.summary = generateSummaryText(uprightCount, reading.themes);
            reading.elementAnalysis = generateElementAnalysis(reading.elements);
            reading.advice = generateAdviceText(uprightCount);
            
            return reading;
        }

        // ç”Ÿæˆæ€»ç»“æ–‡æœ¬
        function generateSummaryText(uprightCount, themes) {
            const uniqueThemes = [...new Set(themes)].slice(0, 3);
            
            if (uprightCount === 3) {
                return `ğŸŒŸ ä»Šæ—¥è¿åŠ¿æä½³ï¼ä¸‰å¼ æ­£ä½ç‰Œæ˜¾ç¤ºèƒ½é‡å……æ²›ï¼Œæ˜¯æ¨è¿›è®¡åˆ’çš„å¥½æ—¶æœºã€‚å…³é”®è¯ï¼š${uniqueThemes.join("ã€")}`;
            } else if (uprightCount === 2) {
                return `âœ¨ ä»Šæ—¥è¿åŠ¿è‰¯å¥½ã€‚ä¸¤å¼ æ­£ä½ç‰Œæ˜¾ç¤ºæ•´ä½“é¡ºåˆ©ï¼Œä½†éœ€ç•™æ„é€†ä½ç‰Œæç¤ºçš„é¢†åŸŸã€‚å…³é”®è¯ï¼š${uniqueThemes.join("ã€")}`;
            } else if (uprightCount === 1) {
                return `â³ ä»Šæ—¥è¿åŠ¿å¹³ç¨³ã€‚éœ€è¦å¹³è¡¡å„æ–¹èƒ½é‡ï¼Œé€†ä½ç‰Œæç¤ºéœ€ç•™æ„çš„æŒ‘æˆ˜ã€‚å…³é”®è¯ï¼š${uniqueThemes.join("ã€")}`;
            } else {
                return `ğŸŒ™ ä»Šæ—¥éœ€è¦è°¨æ…ã€‚ä¸‰å¼ é€†ä½ç‰Œæç¤ºéœ€æ”¾æ…¢è„šæ­¥ï¼Œåæ€è°ƒæ•´åå†è¡ŒåŠ¨ã€‚å…³é”®è¯ï¼š${uniqueThemes.join("ã€")}`;
            }
        }

        // ç”Ÿæˆå…ƒç´ åˆ†æ
        function generateElementAnalysis(elements) {
            if (Object.keys(elements).length === 0) return "";
            
            const elementMeanings = {
                "ç«": "è¡ŒåŠ¨åŠ›å¼ºï¼Œçƒ­æƒ…å……æ²›",
                "æ°´": "æƒ…æ„Ÿä¸°å¯Œï¼Œç›´è§‰æ•é”",
                "é£": "æ€ç»´æ´»è·ƒï¼Œæ²Ÿé€šé¡ºç•…",
                "åœŸ": "åŠ¡å®ç¨³å®šï¼Œè´¢åŠ¡è‰¯å¥½",
                "é‡‘æ˜Ÿ": "çˆ±ä¸ç¾çš„èƒ½é‡",
                "æœ¨æ˜Ÿ": "å¹¸è¿ä¸æ‰©å¼ ",
                "æ°´æ˜Ÿ": "æ²Ÿé€šä¸æ€ç»´",
                "æœˆäº®": "ç›´è§‰ä¸æ½œæ„è¯†",
                "å¤ªé˜³": "æ´»åŠ›ä¸æˆåŠŸ",
                "ç«æ˜Ÿ": "è¡ŒåŠ¨ä¸å‹‡æ°”"
            };
            
            const dominantElement = Object.entries(elements)
                .sort((a, b) => b[1] - a[1])[0][0];
            
            return `ä¸»å¯¼å…ƒç´  ${dominantElement}ï¼š${elementMeanings[dominantElement] || "èƒ½é‡å¹³è¡¡"}`;
        }

        // ç”Ÿæˆå»ºè®®æ–‡æœ¬
        function generateAdviceText(uprightCount) {
            if (uprightCount === 3) {
                return "å¤§èƒ†è¿½æ±‚ç›®æ ‡ï¼Œä½†è¦æ³¨æ„ä¸è¦è¿‡åº¦è‡ªä¿¡";
            } else if (uprightCount === 2) {
                return "æŠŠæ¡æœºä¼šåŒæ—¶ç•™æ„æ½œåœ¨é—®é¢˜";
            } else if (uprightCount === 1) {
                return "é‡è¦å†³å®šè¯·ä¸‰æ€è€Œåè¡Œ";
            } else {
                return "å»ºè®®æ”¾æ…¢è„šæ­¥ï¼Œå¤šåæ€è€Œéè¡ŒåŠ¨";
            }
        }

        // æ˜¾ç¤ºç‰Œç»„
        function displayCards(cards) {
            const cardDisplay = document.getElementById("cardDisplay");
            cardDisplay.innerHTML = "";
            
            if (!cards || cards.length === 0) {
                showError("æœªèƒ½æˆåŠŸæŠ½ç‰Œ");
                return;
            }
            
            hideError();
            cardDisplay.classList.remove("hidden");
            
            cards.forEach((card, index) => {
                const cardEl = document.createElement("div");
                cardEl.className = "card dealing";
                
                let cardInfo = `
                    <div class="card-face card-back"></div>
                    <div class="card-face card-front">
                        <div class="card-name">${card.name}</div>
                `;
                
                if (card.suit) {
                    cardInfo += `<div class="card-suit">${getSuitName(card.suit)}ç‰Œç»„</div>`;
                }
                
                cardInfo += `
                        <div class="card-orientation">${card.orientation}</div>
                    </div>
                `;
                
                cardEl.innerHTML = cardInfo;
                cardDisplay.appendChild(cardEl);
                
                // æ·»åŠ ç‚¹å‡»ç¿»è½¬åŠŸèƒ½
                cardEl.addEventListener('click', function() {
                    this.classList.toggle('flipped');
                });
                
                // è‡ªåŠ¨ç¿»è½¬å¡ç‰‡
                setTimeout(() => {
                    cardEl.classList.remove('dealing');
                    setTimeout(() => {
                        cardEl.classList.add('flipped');
                    }, index * 300);
                }, 100);
            });
        }

        // è·å–èŠ±è‰²åç§°
        function getSuitName(suit) {
            const suitNames = {
                "wands": "æƒæ–",
                "cups": "åœ£æ¯",
                "swords": "å®å‰‘",
                "pentacles": "æ˜Ÿå¸"
            };
            return suitNames[suit] || suit;
        }

        // æ˜¾ç¤ºè§£è¯»
        function displayReading(cards) {
            try {
                const reading = generateOverallReading(cards);
                const categories = ["work", "love", "study"];
                
                // æ˜¾ç¤ºç»¼åˆè§£è¯»
                document.getElementById("overallReading").innerHTML = `
                    <p>${reading.summary}</p>
                    <p>${reading.elementAnalysis}</p>
                `;
                
                // æ˜¾ç¤ºèƒ½é‡æ¡
                document.getElementById("energyLevel").style.width = `${reading.overallEnergy}%`;
                
                // æ˜¾ç¤ºå…ƒç´ æ ‡ç­¾
                const elementTags = document.getElementById("elementTags");
                elementTags.innerHTML = "";
                Object.keys(reading.elements).forEach(element => {
                    const tag = document.createElement("div");
                    tag.className = "element-tag";
                    tag.textContent = element;
                    elementTags.appendChild(tag);
                });
                
                // æ˜¾ç¤ºä»Šæ—¥ç®´è¨€
                document.getElementById("dailyAdvice").textContent = reading.advice;
                
                // æ˜¾ç¤ºå„é¢†åŸŸè§£è¯»
                categories.forEach((category, index) => {
                    const card = cards[index];
                    const isUpright = card.orientation === "æ­£ä½";
                    const meanings = isUpright ? card[category].upright : card[category].reversed;
                    const advice = card[category].advice[isUpright ? "upright" : "reversed"];
                    
                    document.getElementById(`${category}Reading`).innerHTML = `
                        <p><strong>${card.name} ${card.orientation}</strong></p>
                        <p>${meanings.join(" Â· ")}</p>
                        <p><em>å»ºè®®ï¼š${advice}</em></p>
                    `;
                });
                
                document.getElementById("readingDisplay").classList.remove("hidden");
            } catch (error) {
                console.error("è§£è¯»ç”Ÿæˆå¤±è´¥:", error);
                showError("è§£è¯»ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡æ–°æŠ½ç‰Œ");
            }
        }

        // ä¸»å‡½æ•°
        document.getElementById("drawBtn").addEventListener("click", function() {
            const btn = this;
            btn.disabled = true;
            btn.textContent = "æ­£åœ¨æŠ½ç‰Œ...";
            
            // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
            document.getElementById("readingDisplay").classList.add("hidden");
            hideError();
            
            setTimeout(() => {
                try {
                    const cards = drawCards();
                    displayCards(cards);
                    
                    if (cards.length > 0) {
                        setTimeout(() => {
                            displayReading(cards);
                        }, 1500);
                    }
                } catch (error) {
                    console.error("æŠ½ç‰Œæµç¨‹å‡ºé”™:", error);
                    showError("ç³»ç»Ÿå‡ºé”™ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•");
                } finally {
                    btn.disabled = false;
                    btn.textContent = "æŠ½å–ä»Šæ—¥è¿åŠ¿";
                }
            }, 800);
        });

        // ç¦æ­¢åŒå‡»ç¼©æ”¾ (é’ˆå¯¹ç§»åŠ¨ç«¯)
        document.addEventListener('dblclick', function(e) {
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>